<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TRACE</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&display=swap" rel="stylesheet">

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #fff;
  font-family: 'Inter', sans-serif;
  color: #000;
}

canvas {
  position: fixed;
  top: 0;
  left: 0;
}

.ui {
  position: fixed;
  top: 40px; /* 少し上へ */
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  pointer-events: none;
}

h1 {
  margin: 0;
  font-weight: 500;
  font-size: 18px;
  letter-spacing: 0.08em;
}

p {
  margin-top: 6px;
  font-size: 12px;
  opacity: 0.6;
}

.controls {
  position: fixed;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 20px;
}

button {
  background: none;
  border: 1px solid #000;
  padding: 6px 14px;
  font-size: 11px;
  letter-spacing: 0.08em;
  cursor: pointer;
  font-family: 'Inter', sans-serif;
}

button:hover {
  background: #000;
  color: #fff;
}
</style>
</head>

<body>

<canvas id="canvas"></canvas>

<div class="ui">
  <h1>TRACE</h1>
  <p>Move freely. Accumulation defines form.</p>
</div>

<div class="controls">
  <button id="freezeBtn">FREEZE</button>
  <button id="resetBtn">RESET</button>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let width, height;
let points = [];
const maxPoints = 1200; // 蓄積上限（増やすと長く残る）

function resize() {
  width = canvas.width = window.innerWidth;
  height = canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

let drawing = false;

window.addEventListener("mousedown", () => drawing = true);
window.addEventListener("mouseup", () => drawing = false);

window.addEventListener("mousemove", (e) => {
  if (!drawing) return;

  points.push({ x: e.clientX, y: e.clientY });

  if (points.length > maxPoints) {
    points.shift();
  }
});

function draw() {
  ctx.clearRect(0, 0, width, height);

  if (points.length > 1) {
    ctx.beginPath();

    const fadeStart = maxPoints * 0.6; // 60%までは濃く保つ

    for (let i = 0; i < points.length; i++) {
      const p = points[i];

      if (i === 0) {
        ctx.moveTo(p.x, p.y);
      } else {
        let alpha = 0.9;

        if (i > fadeStart) {
          const t = (i - fadeStart) / (maxPoints - fadeStart);
          alpha = 0.9 - t * 0.7; // 徐々に薄く
        }

        ctx.globalAlpha = alpha;
        ctx.lineWidth = 1.4;
        ctx.strokeStyle = "#000";

        ctx.lineTo(p.x, p.y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(p.x, p.y);
      }
    }
  }

  requestAnimationFrame(draw);
}

draw();

// RESET
document.getElementById("resetBtn").addEventListener("click", () => {
  points = [];
  ctx.clearRect(0, 0, width, height);
});

// FREEZE（UI含めて保存）
document.getElementById("freezeBtn").addEventListener("click", () => {
  html2canvas(document.body).then(canvas => {
    const link = document.createElement("a");
    link.download = "trace.png";
    link.href = canvas.toDataURL();
    link.click();
  });
});

// html2canvas CDN
const script = document.createElement("script");
script.src = "https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js";
document.body.appendChild(script);

</script>

</body>
</html>






